<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAPAQ - Formation</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#0f2942,#1e3a5f);padding:10px;color:#333;min-height:100vh;}
.container{max-width:600px;margin:auto;background:white;border-radius:15px;padding:20px;box-shadow:0 5px 30px rgba(0,0,0,.3);}
.header{background:#12263a;color:white;padding:20px;margin:-20px -20px 15px;border-radius:15px 15px 0 0;text-align:center;}
.header h1{font-size:1.5em;margin-bottom:3px;}
.header p{color:#ffc107;font-size:0.85em;}
.back{color:#8ba4bc;text-decoration:none;font-size:0.85em;display:inline-block;margin-bottom:8px;}
.norms{background:#e8f4fd;border:1px solid #bee5eb;border-radius:8px;padding:10px;margin-bottom:12px;font-size:0.8em;color:#0c5460;line-height:1.5;}
.section{background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:12px;}
.section h3{color:#12263a;margin-bottom:10px;font-size:1em;}
label{display:block;font-weight:bold;margin:8px 0 4px;color:#12263a;font-size:0.85em;}
input,textarea,select{width:100%;padding:11px;border:2px solid #ddd;border-radius:8px;font-size:16px;margin-bottom:8px;font-family:inherit;}
input:focus,select:focus{outline:none;border-color:#28a745;}
.item{background:white;padding:12px 15px;border-radius:10px;margin-bottom:8px;border:2px solid #e9ecef;}
.item-header{display:flex;justify-content:space-between;align-items:center;}
.item-name{font-weight:bold;color:#333;font-size:0.9em;}
.item-name small{display:block;color:#888;font-size:0.8em;font-weight:normal;}
.badge{padding:4px 10px;border-radius:15px;font-size:0.75em;font-weight:bold;display:inline-block;}
.badge-ok{background:#d4edda;color:#155724;}.badge-bad{background:#f8d7da;color:#721c24;}.badge-warn{background:#fef3c7;color:#92400e;}
.btn{width:100%;padding:14px;border:none;border-radius:10px;font-size:1em;font-weight:bold;cursor:pointer;margin-top:8px;}
.btn-add{background:#28a745;color:white;}.btn-submit{background:#ffc107;color:#12263a;text-transform:uppercase;letter-spacing:1px;margin-top:15px;}
.btn-add:active,.btn-submit:active{transform:scale(0.98);}
.sig-box{border:3px dashed #ccc;border-radius:10px;height:120px;background:white;position:relative;cursor:crosshair;touch-action:none;}
.sig-box canvas{width:100%;height:100%;}.sig-clear{position:absolute;top:5px;right:5px;background:#d9534f;color:white;border:none;padding:4px 10px;border-radius:5px;font-size:0.75em;cursor:pointer;}
.emp-bar{background:#12263a;color:white;padding:8px 15px;margin:-20px -20px 15px;display:flex;justify-content:space-between;font-size:0.85em;}
.emp-bar .name{color:#ffc107;font-weight:bold;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
#result{display:none;}
.success{background:#d4edda;border:2px solid #28a745;padding:20px;border-radius:10px;color:#155724;}
.success h2{margin-bottom:10px;color:#28a745;}
.report{background:white;padding:12px;border-radius:8px;margin:12px 0;border-left:4px solid #28a745;max-height:300px;overflow-y:auto;}
.report pre{white-space:pre-wrap;font-size:0.8em;line-height:1.5;font-family:monospace;}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}
.action-btns button{padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;color:white;font-size:0.85em;}
</style>
</head>
<body>
<div class="container">
<div class="header">
<a class="back" href="mapaq.html">‚Üê Retour aux registres</a>
<h1>üë®‚Äçüç≥ FORMATION</h1>
<p>PERSONNEL ‚Äî MAPAQ</p>
</div>

<div id="login">
<div class="section">
<h3>üë§ Identification</h3>
<label>Votre nom</label><input type="text" id="user-name" placeholder="Pr√©nom et nom">
<label>Poste</label><select id="user-poste"><option>Cuisinier(√®re)</option><option>Chef / Sous-chef</option><option>Gestionnaire</option><option>Plongeur(euse)</option><option>Serveur(euse)</option><option>Commis</option><option>Propri√©taire</option></select>
<button class="btn btn-submit" onclick="doLogin()">COMMENCER ‚Üí</button>
</div>
</div>

<div id="main" style="display:none;">
<div class="emp-bar"><span>üë§ <span class="name" id="d-name"></span></span><span id="d-date"></span></div>
<div class="norms"><strong>MAPAQ :</strong> Min. 10% du personnel doit avoir la formation Manipulateur d'aliments (6h). Un gestionnaire certifi√© en hygi√®ne et salubrit√© (3h30) est obligatoire par √©tablissement.</div>

<div class="section">
<h3>üë®‚Äçüç≥ Ajouter une formation</h3>
<div class="g2"><div><label>Nom de l'employ√©</label><input type="text" id="f-nom" placeholder="Pr√©nom et nom"></div><div><label>Poste</label><input type="text" id="f-poste" placeholder="Ex: Cuisinier"></div></div>
<label>Type de formation</label>
<select id="f-type"><option>Manipulateur d'aliments (6h)</option><option>Gestionnaire hygi√®ne-salubrit√© (3h30)</option><option>Formation interne</option><option>Allerg√®nes</option><option>HACCP</option></select>
<label>N¬∞ attestation MAPAQ</label>
<input type="text" id="f-att" placeholder="Num√©ro d'attestation">
<div class="g3"><div><label>Date formation</label><input type="date" id="f-date"></div><div><label>Date expiration</label><input type="date" id="f-exp"></div><div><label>Formateur</label><input type="text" id="f-formateur" placeholder="Nom"></div></div>
<button class="btn btn-add" onclick="addEntry()">‚úì AJOUTER L'EMPLOY√â</button>
</div>

<div id="entries"></div>
<div id="entry-count" style="text-align:center;color:#888;font-size:0.85em;margin:10px 0;"></div>

<div class="section"><h3>‚úçÔ∏è Signature du gestionnaire</h3><div class="sig-box"><canvas id="canvas"></canvas><button class="sig-clear" onclick="clearSig()">Effacer</button></div></div>
<button class="btn btn-submit" onclick="submitForm()">üöÄ SOUMETTRE</button>
</div>

<div id="result">
<div class="success">
<h2>‚úÖ FORMATIONS ENREGISTR√âES</h2>
<p><strong>Saisi par:</strong> <span id="r-emp"></span></p>
<p><strong>Date:</strong> <span id="r-date"></span></p>
<div class="report"><pre id="report-text"></pre></div>
<div class="action-btns">
<button onclick="emailReport()" style="background:#007bff;">üìß EMAIL</button>
<button onclick="copyReport()" style="background:#6c757d;">üìã COPIER</button>
<button onclick="downloadTXT()" style="background:#28a745;">üíæ TXT</button>
<button onclick="location.reload()" style="background:#17a2b8;">üîÑ NOUVEAU</button>
</div>
<div style="margin-top:12px;text-align:center;"><a href="mapaq.html" style="color:#155724;font-weight:bold;">‚Üê Retour aux registres</a></div>
</div>
</div>
</div>

<script>
let user={},entries=[],hasSig=false;
function doLogin(){const n=document.getElementById('user-name').value.trim();if(!n){alert('‚ùå Entrez votre nom');return;}user={nom:n,poste:document.getElementById('user-poste').value};document.getElementById('d-name').textContent=n;document.getElementById('d-date').textContent=new Date().toLocaleDateString('fr-CA');document.getElementById('login').style.display='none';document.getElementById('main').style.display='block';initCanvas();}
function addEntry(){
  const nom=document.getElementById('f-nom').value.trim();const dateF=document.getElementById('f-date').value;
  if(!nom){alert('‚ùå Entrez le nom');return;}if(!dateF){alert('‚ùå Entrez la date de formation');return;}
  const exp=document.getElementById('f-exp').value;const expired=exp&&new Date(exp)<new Date();
  entries.push({nom,poste:document.getElementById('f-poste').value,type:document.getElementById('f-type').value,attestation:document.getElementById('f-att').value,dateFormation:dateF,dateExpiration:exp,formateur:document.getElementById('f-formateur').value,statut:expired?'Expir√©':'Valide',saisiPar:user.nom});
  document.getElementById('f-nom').value='';document.getElementById('f-poste').value='';document.getElementById('f-att').value='';document.getElementById('f-date').value='';document.getElementById('f-exp').value='';document.getElementById('f-formateur').value='';render();
}
function render(){
  document.getElementById('entries').innerHTML=entries.map(e=>`<div class="item" style="border-left:4px solid ${e.statut==='Valide'?'#28a745':'#d9534f'};"><div class="item-header"><div class="item-name">${e.nom}<small>${e.type}</small></div><span class="badge ${e.statut==='Valide'?'badge-ok':'badge-bad'}">${e.statut==='Valide'?'‚úì Valide':'‚úó Expir√©'}</span></div><div style="font-size:0.8em;color:#666;margin-top:4px;">${e.attestation?'Att: '+e.attestation+' ¬∑ ':''}${e.dateFormation}${e.dateExpiration?' ‚Üí '+e.dateExpiration:''}</div></div>`).join('');
  document.getElementById('entry-count').textContent=`${entries.length} employ√©(s) enregistr√©(s)`;
}
let canvas,ctx,drawing=false;
function initCanvas(){canvas=document.getElementById('canvas');ctx=canvas.getContext('2d');setTimeout(()=>{canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;ctx.lineWidth=2;ctx.lineCap='round';ctx.strokeStyle='#000';},100);canvas.addEventListener('mousedown',e=>{drawing=true;hasSig=true;const r=canvas.getBoundingClientRect();ctx.beginPath();ctx.moveTo(e.clientX-r.left,e.clientY-r.top);});canvas.addEventListener('mousemove',e=>{if(!drawing)return;const r=canvas.getBoundingClientRect();ctx.lineTo(e.clientX-r.left,e.clientY-r.top);ctx.stroke();});canvas.addEventListener('mouseup',()=>drawing=false);canvas.addEventListener('touchstart',e=>{e.preventDefault();drawing=true;hasSig=true;const r=canvas.getBoundingClientRect();ctx.beginPath();ctx.moveTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);});canvas.addEventListener('touchmove',e=>{e.preventDefault();if(!drawing)return;const r=canvas.getBoundingClientRect();ctx.lineTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);ctx.stroke();});canvas.addEventListener('touchend',()=>drawing=false);}
function clearSig(){ctx.clearRect(0,0,canvas.width,canvas.height);hasSig=false;}
function submitForm(){
  if(entries.length===0){alert('‚ùå Ajoutez au moins un employ√©');return;}if(!hasSig){alert('‚ùå Veuillez signer');return;}
  const exp=entries.filter(e=>e.statut==='Expir√©').length;const today=new Date().toLocaleDateString('fr-CA');
  let rpt=`‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  FORMATION DU PERSONNEL ‚Äî MAPAQ\n  ${today}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüë§ Saisi par: ${user.nom} (${user.poste})\nüìÖ Date: ${today}\nüìä Total: ${entries.length} employ√©(s)${exp>0?' ¬∑ ‚ö†Ô∏è '+exp+' attestation(s) expir√©e(s)':' ¬∑ ‚úÖ Tout √† jour'}\n\n`;
  entries.forEach((e,i)=>{rpt+=`${i+1}. ${e.nom} (${e.poste||'N/A'}) ‚Äî ${e.type}\n   Att: ${e.attestation||'N/A'} | Formation: ${e.dateFormation} | Exp: ${e.dateExpiration||'N/A'} | ${e.statut==='Valide'?'‚úì Valide':'‚úó EXPIR√â'}\n`;});
  rpt+=`\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nG√©n√©r√©: ${new Date().toLocaleString('fr-CA')}\n`;
  window.currentReport=rpt;window.currentData={employe:user.nom,date:today};
  document.getElementById('r-emp').textContent=user.nom;document.getElementById('r-date').textContent=today;document.getElementById('report-text').textContent=rpt;
  document.getElementById('main').style.display='none';document.getElementById('result').style.display='block';window.scrollTo(0,0);
}
function emailReport(){window.location.href=`mailto:Mjacquesperrier@gmail.com?subject=${encodeURIComponent('Formation MAPAQ - '+window.currentData.date)}&body=${encodeURIComponent(window.currentReport)}`;}
function copyReport(){navigator.clipboard.writeText(window.currentReport).then(()=>alert('‚úÖ Copi√©!')).catch(()=>{const el=document.createElement('textarea');el.value=window.currentReport;document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);alert('‚úÖ Copi√©!');});}
function downloadTXT(){const b=new Blob([window.currentReport],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`MAPAQ_Formation_${window.currentData.date}.txt`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);}
</script>

</body>
</html>
