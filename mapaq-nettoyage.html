<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAPAQ - Nettoyage</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#0f2942,#1e3a5f);padding:10px;color:#333;min-height:100vh;}.container{max-width:600px;margin:auto;background:white;border-radius:15px;padding:20px;box-shadow:0 5px 30px rgba(0,0,0,.3);}.header{background:#12263a;color:white;padding:20px;margin:-20px -20px 15px;border-radius:15px 15px 0 0;text-align:center;}.header h1{font-size:1.5em;margin-bottom:3px;}.header p{color:#ffc107;font-size:0.85em;}.back{color:#8ba4bc;text-decoration:none;font-size:0.85em;display:inline-block;margin-bottom:8px;}.norms{background:#e8f4fd;border:1px solid #bee5eb;border-radius:8px;padding:10px;margin-bottom:12px;font-size:0.8em;color:#0c5460;line-height:1.5;}.section{background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:12px;}.section h3{color:#12263a;margin-bottom:10px;font-size:1em;}label{display:block;font-weight:bold;margin:8px 0 4px;color:#12263a;font-size:0.85em;}input,textarea,select{width:100%;padding:11px;border:2px solid #ddd;border-radius:8px;font-size:16px;margin-bottom:8px;font-family:inherit;}input:focus,select:focus,textarea:focus{outline:none;border-color:#28a745;}.item{background:white;padding:12px 15px;border-radius:10px;margin-bottom:8px;border:2px solid #e9ecef;}.item-header{display:flex;justify-content:space-between;align-items:center;}.item-name{font-weight:bold;color:#333;font-size:0.9em;}.item-name small{display:block;color:#888;font-size:0.8em;font-weight:normal;}.buttons{display:flex;gap:8px;}.buttons button{padding:10px 16px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;font-size:0.85em;}.btn-ok{background:#e9ecef;color:#666;}.btn-ok.active{background:#28a745;color:white;box-shadow:0 3px 8px rgba(40,167,69,.4);}.btn-def{background:#e9ecef;color:#666;}.btn-def.active{background:#d9534f;color:white;box-shadow:0 3px 8px rgba(217,83,79,.4);}.badge{padding:4px 10px;border-radius:15px;font-size:0.75em;font-weight:bold;display:inline-block;}.badge-ok{background:#d4edda;color:#155724;}.badge-wait{background:#fef3c7;color:#92400e;}.btn{width:100%;padding:14px;border:none;border-radius:10px;font-size:1em;font-weight:bold;cursor:pointer;margin-top:8px;}.btn-add{background:#28a745;color:white;}.btn-submit{background:#ffc107;color:#12263a;text-transform:uppercase;letter-spacing:1px;margin-top:15px;}.btn-add:active,.btn-submit:active{transform:scale(0.98);}.sig-box{border:3px dashed #ccc;border-radius:10px;height:120px;background:white;position:relative;cursor:crosshair;touch-action:none;}.sig-box canvas{width:100%;height:100%;}.sig-clear{position:absolute;top:5px;right:5px;background:#d9534f;color:white;border:none;padding:4px 10px;border-radius:5px;font-size:0.75em;cursor:pointer;}.emp-bar{background:#12263a;color:white;padding:8px 15px;margin:-20px -20px 15px;display:flex;justify-content:space-between;font-size:0.85em;}.emp-bar .name{color:#ffc107;font-weight:bold;}.g2{display:grid;grid-template-columns:1fr 1fr;gap:8px;}#result{display:none;}.success{background:#d4edda;border:2px solid #28a745;padding:20px;border-radius:10px;color:#155724;}.success h2{margin-bottom:10px;color:#28a745;}.report{background:white;padding:12px;border-radius:8px;margin:12px 0;border-left:4px solid #28a745;max-height:300px;overflow-y:auto;}.report pre{white-space:pre-wrap;font-size:0.8em;line-height:1.5;font-family:monospace;}.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}.action-btns button{padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;color:white;font-size:0.85em;}.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#12263a;color:white;padding:10px 20px;border-radius:8px;font-size:0.85em;display:none;z-index:999;}
</style>
</head>
<body>
<div class="toast" id="toast"></div>
<div class="container">
<div class="header"><a class="back" href="mapaq.html">â† Retour aux registres</a><h1>ğŸ§¹ NETTOYAGE</h1><p>ASSAINISSEMENT â€” MAPAQ</p></div>
<div id="login"><div class="section"><h3>ğŸ‘¤ Identification</h3><label>Votre nom</label><input type="text" id="user-name" placeholder="PrÃ©nom et nom"><label>Poste</label><select id="user-poste"><option>Cuisinier(Ã¨re)</option><option>Chef / Sous-chef</option><option>Gestionnaire</option><option>Plongeur(euse)</option><option>Serveur(euse)</option><option>Commis</option><option>PropriÃ©taire</option></select><button class="btn btn-submit" onclick="doLogin()">COMMENCER â†’</button></div></div>
<div id="main" style="display:none;">
<div class="emp-bar"><span>ğŸ‘¤ <span class="name" id="d-name"></span></span><span id="d-date"></span></div>
<div class="norms"><strong>MAPAQ :</strong> Le nettoyage et l'assainissement sont deux Ã©tapes distinctes et indissociables.</div>
<div class="section"><h3>ğŸ§¹ Enregistrer un nettoyage</h3>
<label>Zone / Ã‰quipement</label><select id="zone"><option>Surfaces de travail / comptoirs</option><option>Planches Ã  dÃ©couper</option><option>Ã‰quipement de cuisson</option><option>Hottes et filtres</option><option>RÃ©frigÃ©rateurs (intÃ©rieur)</option><option>Planchers et drains</option><option>Toilettes / vestiaires</option><option>Poubelles et bacs</option><option>Ustensiles et vaisselle</option><option>Ã‰vier Ã  mains</option></select>
<label>FrÃ©quence</label><select id="freq"><option>Chaque service</option><option>Quotidien</option><option>Hebdomadaire</option><option>Mensuel</option></select>
<div class="g2"><div><label>Produit</label><input type="text" id="produit" placeholder="Ex: Chlore..."></div><div><label>Concentration (ppm)</label><input type="text" id="conc" placeholder="Ex: 200"></div></div>
<div class="item" style="border-color:#ffc107;margin-top:8px;"><div class="item-header"><div class="item-name">VÃ©rifiÃ© par gestionnaire?</div><div class="buttons"><button class="btn-ok" id="v-ok" onclick="setVerif(true)">âœ“ OUI</button><button class="btn-def" id="v-non" onclick="setVerif(false)">âœ— NON</button></div></div></div>
<button class="btn btn-add" onclick="addEntry()">âœ“ ENREGISTRER</button></div>
<div id="entries"></div><div id="entry-count" style="text-align:center;color:#888;font-size:0.85em;margin:10px 0;"></div>
<div class="section"><h3>âœï¸ Signature</h3><div class="sig-box"><canvas id="canvas"></canvas><button class="sig-clear" onclick="clearSig()">Effacer</button></div></div>
<button class="btn btn-submit" onclick="submitForm()">ğŸš€ SOUMETTRE</button></div>
<div id="result"><div class="success"><h2>âœ… NETTOYAGE ENREGISTRÃ‰</h2><p><strong>Responsable:</strong> <span id="r-emp"></span></p><p><strong>Date:</strong> <span id="r-date"></span></p><p id="sheets-status" style="margin-top:5px;"></p><div class="report"><pre id="report-text"></pre></div><div class="action-btns"><button onclick="emailReport()" style="background:#007bff;">ğŸ“§ EMAIL</button><button onclick="copyReport()" style="background:#6c757d;">ğŸ“‹ COPIER</button><button onclick="downloadTXT()" style="background:#28a745;">ğŸ’¾ TXT</button><button onclick="location.reload()" style="background:#17a2b8;">ğŸ”„ NOUVEAU</button></div><div style="margin-top:12px;text-align:center;"><a href="mapaq.html" style="color:#155724;font-weight:bold;">â† Retour aux registres</a></div></div></div>
</div>
<script>
const SHEETS_URL="https://script.google.com/macros/s/AKfycbws6nE1vzvCUEdZt8wiKytYS2RHC1rpOlM05dOTswhtAKJZsaSpumCUXSeujc0tp6g4Sw/exec";
let user={},entries=[],verifie=null,hasSig=false;
function showToast(m){const t=document.getElementById('toast');t.textContent=m;t.style.display='block';setTimeout(()=>t.style.display='none',3000);}
function doLogin(){const n=document.getElementById('user-name').value.trim();if(!n){alert('âŒ Entrez votre nom');return;}user={nom:n,poste:document.getElementById('user-poste').value};document.getElementById('d-name').textContent=n;document.getElementById('d-date').textContent=new Date().toLocaleDateString('fr-CA');document.getElementById('login').style.display='none';document.getElementById('main').style.display='block';initCanvas();}
function setVerif(v){verifie=v;document.getElementById('v-ok').className='btn-ok'+(v?' active':'');document.getElementById('v-non').className='btn-def'+(!v?' active':'');}
function addEntry(){if(verifie===null){alert('âŒ Indiquez si vÃ©rifiÃ©');return;}entries.push({date:new Date().toLocaleDateString('fr-CA'),heure:new Date().toLocaleTimeString('fr-CA',{hour:'2-digit',minute:'2-digit'}),zone:document.getElementById('zone').value,frequence:document.getElementById('freq').value,produit:document.getElementById('produit').value,concentration:document.getElementById('conc').value,verifie,responsable:user.nom});document.getElementById('produit').value='';document.getElementById('conc').value='';verifie=null;document.getElementById('v-ok').className='btn-ok';document.getElementById('v-non').className='btn-def';render();showToast('âœ“ Nettoyage ajoutÃ©');}
function render(){document.getElementById('entries').innerHTML=entries.map(e=>`<div class="item" style="border-left:4px solid ${e.verifie?'#28a745':'#ffc107'};"><div class="item-header"><div class="item-name">${e.zone}<small>${e.date} ${e.heure} Â· ${e.frequence}</small></div><span class="badge ${e.verifie?'badge-ok':'badge-wait'}">${e.verifie?'âœ“ VÃ©rifiÃ©':'â³ Attente'}</span></div>${e.produit?`<div style="font-size:0.8em;color:#666;margin-top:4px;">Produit: ${e.produit} ${e.concentration?'Â· '+e.concentration+' ppm':''}</div>`:''}</div>`).join('');document.getElementById('entry-count').textContent=`${entries.length} nettoyage(s)`;}
let canvas,ctx,drawing=false;
function initCanvas(){canvas=document.getElementById('canvas');ctx=canvas.getContext('2d');setTimeout(()=>{canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;ctx.lineWidth=2;ctx.lineCap='round';ctx.strokeStyle='#000';},100);canvas.addEventListener('mousedown',e=>{drawing=true;hasSig=true;const r=canvas.getBoundingClientRect();ctx.beginPath();ctx.moveTo(e.clientX-r.left,e.clientY-r.top);});canvas.addEventListener('mousemove',e=>{if(!drawing)return;const r=canvas.getBoundingClientRect();ctx.lineTo(e.clientX-r.left,e.clientY-r.top);ctx.stroke();});canvas.addEventListener('mouseup',()=>drawing=false);canvas.addEventListener('touchstart',e=>{e.preventDefault();drawing=true;hasSig=true;const r=canvas.getBoundingClientRect();ctx.beginPath();ctx.moveTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);});canvas.addEventListener('touchmove',e=>{e.preventDefault();if(!drawing)return;const r=canvas.getBoundingClientRect();ctx.lineTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);ctx.stroke();});canvas.addEventListener('touchend',()=>drawing=false);}
function clearSig(){ctx.clearRect(0,0,canvas.width,canvas.height);hasSig=false;}
async function submitForm(){if(entries.length===0){alert('âŒ Ajoutez au moins un nettoyage');return;}if(!hasSig){alert('âŒ Veuillez signer');return;}
const today=new Date().toLocaleDateString('fr-CA');const nv=entries.filter(e=>!e.verifie).length;
let rpt=`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  REGISTRE NETTOYAGE â€” MAPAQ\n  ${today}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ‘¤ Responsable: ${user.nom} (${user.poste})\nğŸ“… Date: ${today}\nğŸ“Š Total: ${entries.length}${nv>0?' Â· '+nv+' en attente':''}\n\n`;
entries.forEach((e,i)=>{rpt+=`${i+1}. ${e.zone} (${e.frequence}) ${e.verifie?'âœ“':'â³'}\n`;if(e.produit)rpt+=`   Produit: ${e.produit} ${e.concentration?e.concentration+' ppm':''}\n`;});
rpt+=`\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGÃ©nÃ©rÃ©: ${new Date().toLocaleString('fr-CA')}\n`;
window.currentReport=rpt;window.currentData={employe:user.nom,date:today};
try{await fetch(SHEETS_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'text/plain'},body:JSON.stringify({type:"nettoyage",entries})});document.getElementById('sheets-status').innerHTML='ğŸ“Š <strong style="color:#28a745;">EnvoyÃ© Ã  Google Sheets âœ“</strong>';}catch(err){document.getElementById('sheets-status').innerHTML='âš ï¸ Envoi en cours...';}
document.getElementById('r-emp').textContent=user.nom;document.getElementById('r-date').textContent=today;document.getElementById('report-text').textContent=rpt;document.getElementById('main').style.display='none';document.getElementById('result').style.display='block';window.scrollTo(0,0);}
function emailReport(){window.location.href=`mailto:Mjacquesperrier@gmail.com?subject=${encodeURIComponent('Nettoyage MAPAQ - '+window.currentData.date)}&body=${encodeURIComponent(window.currentReport)}`;}
function copyReport(){navigator.clipboard.writeText(window.currentReport).then(()=>alert('âœ… CopiÃ©!')).catch(()=>{const el=document.createElement('textarea');el.value=window.currentReport;document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);alert('âœ… CopiÃ©!');});}
function downloadTXT(){const b=new Blob([window.currentReport],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`MAPAQ_Nettoyage_${window.currentData.date}.txt`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);}
</script>
</body>
</html>
