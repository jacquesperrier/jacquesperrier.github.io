<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOISELLE - Inspection Quotidienne</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #0d1b2a, #1a2f42); padding: 15px; color: #333; }
.container { max-width: 600px; margin: auto; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); }
.header { background: #12263a; color: white; padding: 25px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0; text-align: center; }
.header h1 { font-size: 2em; margin-bottom: 5px; letter-spacing: 2px; }
.header p { color: #ffc107; font-size: 0.9em; }
.section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
.section h3 { color: #12263a; margin-bottom: 10px; font-size: 1.1em; }
label { display: block; font-weight: bold; margin: 10px 0 5px 0; color: #12263a; font-size: 0.9em; }
input, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; }
input:focus, textarea:focus { outline: none; border-color: #28a745; }
.item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #e9ecef; }
.item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.item-name { font-weight: bold; color: #333; }
.item-name small { display: block; color: #888; font-size: 0.85em; font-weight: normal; }
.buttons { display: flex; gap: 10px; }
.buttons button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.9em; }
.btn-ok { background: #e9ecef; color: #666; }
.btn-ok.active { background: #28a745; color: white; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.4); }
.btn-def { background: #e9ecef; color: #666; }
.btn-def.active { background: #d9534f; color: white; box-shadow: 0 4px 10px rgba(217, 83, 79, 0.4); }
.defect-zone { display: none; margin-top: 10px; padding: 10px; background: #fff5f5; border-radius: 8px; border: 2px dashed #d9534f; }
.sig-box { border: 3px dashed #ccc; border-radius: 10px; height: 150px; background: white; position: relative; cursor: crosshair; }
.sig-box canvas { width: 100%; height: 100%; }
.sig-clear { position: absolute; top: 5px; right: 5px; background: #d9534f; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; cursor: pointer; }
.btn-submit { background: #ffc107; color: #12263a; width: 100%; padding: 18px; border: none; border-radius: 10px; font-size: 1.2em; font-weight: bold; cursor: pointer; margin-top: 20px; text-transform: uppercase; }
.btn-submit:active { transform: scale(0.98); }
#result { display: none; margin-top: 20px; }
.success { background: #d4edda; border: 2px solid #28a745; padding: 20px; border-radius: 10px; color: #155724; }
.success h2 { margin-bottom: 15px; color: #28a745; }
.report { background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #28a745; max-height: 400px; overflow-y: auto; }
.report pre { white-space: pre-wrap; font-size: 0.9em; line-height: 1.6; font-family: monospace; }
.action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
.action-btns button { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
.progress { background: #e9ecef; height: 8px; border-radius: 10px; overflow: hidden; margin: 10px 0; }
.progress-bar { background: #28a745; height: 100%; width: 0%; transition: width 0.3s; }
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>ğŸš› LOISELLE</h1>
<p>INSPECTION QUOTIDIENNE / DAILY INSPECTION</p>
</div>

<div id="form-section">
<div class="section">
<h3>ğŸ“‹ Informations</h3>
<label>ğŸ‘¤ EmployÃ© / Employee</label>
<input type="text" id="employe" placeholder="Nom complet" required>
<label>ğŸ”¢ Plaque / Plate</label>
<input type="text" id="plaque" placeholder="ABC-123" required>
<label>ğŸš› UnitÃ© / Unit</label>
<input type="text" id="unite" placeholder="NumÃ©ro d'unitÃ©" required>
<label>ğŸ“… Date</label>
<input type="date" id="date" required>
<label>ğŸ• Heure / Time</label>
<input type="time" id="heure" required>
<label>ğŸ“ Lieu / Location</label>
<input type="text" id="lieu" placeholder="Ville ou adresse">
</div>

<div class="section">
<h3>ğŸ” Points d'inspection</h3>
<div class="progress"><div class="progress-bar" id="progress"></div></div>
<p style="text-align: center; color: #666; font-size: 0.9em;" id="progress-text">0/8 complÃ©tÃ©s</p>
</div>

<!-- ITEM 1 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ’§ Niveaux & Fuites<small>Fluids & Leaks</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(0, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(0, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-0">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-0" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 2 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ”§ Pneus & Boulons<small>Tires & Bolts</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(1, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(1, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-1">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-1" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 3 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ›‘ Freins & Boyaux<small>Brakes & Hoses</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(2, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(2, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-2">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-2" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 4 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ’¡ LumiÃ¨res & Gyrophare<small>Lights & Beacon</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(3, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(3, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-3">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-3" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 5 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ¯ Direction & Suspension<small>Steering & Suspension</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(4, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(4, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-4">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-4" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 6 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸª Miroirs & Pare-brise<small>Mirrors & Windshield</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(5, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(5, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-5">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-5" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 7 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ§¯ SÃ©curitÃ©<small>Safety Equipment</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(6, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(6, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-6">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-6" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<!-- ITEM 8 -->

<div class="item">
<div class="item-header">
<div class="item-name">ğŸ“¦ Chargement<small>Load Security</small></div>
<div class="buttons">
<button class="btn-ok" onclick="setStatus(7, 'OK')">OK</button>
<button class="btn-def" onclick="setStatus(7, 'DEF')">DEF</button>
</div>
</div>
<div class="defect-zone" id="defect-7">
<label style="color: #d9534f; font-size: 0.9em;">Note du dÃ©faut:</label>
<textarea id="note-7" placeholder="DÃ©crivez le dÃ©faut..."></textarea>
</div>
</div>

<div class="section">
<h3>ğŸ’¬ Commentaires</h3>
<textarea id="comments" rows="3" placeholder="Notes gÃ©nÃ©rales..."></textarea>
</div>

<div class="section">
<h3>âœï¸ Signature</h3>
<div class="sig-box">
<canvas id="canvas"></canvas>
<button class="sig-clear" onclick="clearSig()">Effacer</button>
</div>
</div>

<button class="btn-submit" onclick="submitForm()">ğŸš€ SOUMETTRE / SUBMIT</button>

</div>

<div id="result">
<div class="success">
<h2>âœ… INSPECTION ENREGISTRÃ‰E</h2>
<p><strong>EmployÃ©:</strong> <span id="r-emp"></span></p>
<p><strong>Plaque:</strong> <span id="r-plaque"></span></p>
<p><strong>Date:</strong> <span id="r-date"></span></p>
<p><strong>Statut:</strong> <span id="r-status"></span></p>
<div class="report"><pre id="report-text"></pre></div>
<div class="action-btns">
<button onclick="emailReport()" style="background: #007bff;">ğŸ“§ EMAIL</button>
<button onclick="copyReport()" style="background: #6c757d;">ğŸ“‹ COPIER</button>
<button onclick="downloadTXT()" style="background: #28a745;">ğŸ’¾ TXT</button>
<button onclick="location.reload()" style="background: #17a2b8;">ğŸ”„ NOUVEAU</button>
</div>
</div>
</div>
</div>

<script>
const items = [
{fr: "ğŸ’§ Niveaux & Fuites", en: "Fluids & Leaks"},
{fr: "ğŸ”§ Pneus & Boulons", en: "Tires & Bolts"},
{fr: "ğŸ›‘ Freins & Boyaux", en: "Brakes & Hoses"},
{fr: "ğŸ’¡ LumiÃ¨res & Gyrophare", en: "Lights & Beacon"},
{fr: "ğŸ¯ Direction & Suspension", en: "Steering & Suspension"},
{fr: "ğŸª Miroirs & Pare-brise", en: "Mirrors & Windshield"},
{fr: "ğŸ§¯ SÃ©curitÃ©", en: "Safety Equipment"},
{fr: "ğŸ“¦ Chargement", en: "Load Security"}
];

let inspectionData = { items: [null,null,null,null,null,null,null,null] };

window.onload = function() {
document.getElementById('date').valueAsDate = new Date();
document.getElementById('heure').value = new Date().toTimeString().slice(0,5);
resizeCanvas();
};

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let drawing = false;
let hasSig = false;

function resizeCanvas() {
canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;
ctx.lineWidth = 2;
ctx.lineCap = 'round';
ctx.strokeStyle = '#000';
}

canvas.addEventListener('mousedown', (e) => startDraw(e));
canvas.addEventListener('mousemove', (e) => draw(e));
canvas.addEventListener('mouseup', stopDraw);
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e.touches[0]); });
canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); });
canvas.addEventListener('touchend', stopDraw);

function startDraw(e) {
drawing = true;
hasSig = true;
const rect = canvas.getBoundingClientRect();
ctx.beginPath();
ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
}

function draw(e) {
if (!drawing) return;
const rect = canvas.getBoundingClientRect();
ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
ctx.stroke();
}

function stopDraw() { drawing = false; }

function clearSig() {
ctx.clearRect(0, 0, canvas.width, canvas.height);
hasSig = false;
}

function setStatus(index, status) {
const item = document.querySelectorAll('.item')[index];
const okBtn = item.querySelector('.btn-ok');
const defBtn = item.querySelector('.btn-def');
const defZone = document.getElementById(`defect-${index}`);
if (status === 'OK') {
okBtn.classList.add('active');
defBtn.classList.remove('active');
defZone.style.display = 'none';
inspectionData.items[index] = { status: 'OK', note: '' };
} else {
defBtn.classList.add('active');
okBtn.classList.remove('active');
defZone.style.display = 'block';
inspectionData.items[index] = { status: 'DEF', note: '' };
}
updateProgress();
}

function updateProgress() {
const completed = inspectionData.items.filter(i => i !== null).length;
const percent = (completed / 8) * 100;
document.getElementById('progress').style.width = percent + '%';
document.getElementById('progress-text').textContent = `${completed}/8 complÃ©tÃ©s`;
}

async function submitForm() {
if (!document.getElementById('employe').value) { alert('âŒ Veuillez entrer le nom de l\'employÃ©'); return; }
if (!document.getElementById('plaque').value) { alert('âŒ Veuillez entrer la plaque'); return; }
if (inspectionData.items.filter(i => i !== null).length !== 8) { alert('âŒ Veuillez cocher tous les items'); return; }
if (!hasSig) { alert('âŒ Veuillez signer'); return; }

inspectionData.items.forEach((item, i) => {
if (item && item.status === 'DEF') item.note = document.getElementById(`note-${i}`).value;
});

const data = {
employe: document.getElementById('employe').value,
plaque: document.getElementById('plaque').value,
unite: document.getElementById('unite').value,
date: document.getElementById('date').value,
heure: document.getElementById('heure').value,
lieu: document.getElementById('lieu').value || 'Non spÃ©cifiÃ©',
commentaires: document.getElementById('comments').value,
items: inspectionData.items.map((item, i) => ({
nom: items[i].fr,
name: items[i].en,
statut: item.status,
note: item.note
}))
};

const defectCount = data.items.filter(i => i.statut === 'DEF').length;
const isCompliant = defectCount === 0;

let reportText = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RAPPORT D'INSPECTION LOISELLE
  LOISELLE INSPECTION REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ EmployÃ©: ${data.employe}
ğŸ”¢ Plaque: ${data.plaque}
ğŸš› UnitÃ©: ${data.unite}
ğŸ“… Date: ${data.date}
ğŸ• Heure: ${data.heure}
ğŸ“ Lieu: ${data.lieu}

ğŸ“Š STATUT: ${isCompliant ? 'âœ… CONFORME / COMPLIANT' : 'âš ï¸ NON-CONFORME / NON-COMPLIANT'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DÃ‰TAILS D'INSPECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

`;

data.items.forEach((item, i) => {
reportText += `${i+1}. ${item.nom}: ${item.statut}\n`;
if (item.statut === 'DEF' && item.note) reportText += `   ğŸ“ ${item.note}\n`;
});

if (data.commentaires) reportText += `\nğŸ’¬ COMMENTAIRES:\n${data.commentaires}\n`;
reportText += `\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;
reportText += `GÃ©nÃ©rÃ©: ${new Date().toLocaleString()}\n`;

window.currentReport = reportText;
window.currentData = data;

// ENVOI FORMSPREE (EMAIL AUTOMATIQUE)
try {
const subject = isCompliant 
  ? `âœ… CONFORME - Inspection LOISELLE - ${data.plaque}`
  : `âš ï¸ DÃ‰FAUT (${defectCount}) - Inspection LOISELLE - ${data.plaque}`;

// Email principal Ã  Mjacquesperrier@gmail.com
await fetch('https://formspree.io/f/xpzygkqr', {
method: 'POST',
headers: { 
'Content-Type': 'application/json', 
'Accept': 'application/json' 
},
body: JSON.stringify({
_subject: subject,
message: reportText,
employe: data.employe,
plaque: data.plaque,
unite: data.unite,
date: data.date,
heure: data.heure,
lieu: data.lieu,
statut: isCompliant ? 'CONFORME' : 'NON-CONFORME',
nb_defauts: defectCount
})
});
console.log('âœ… Email principal envoyÃ© Ã  Mjacquesperrier@gmail.com');

// Si NON-CONFORME, envoyer un email d'alerte Ã  Jacques
if (!isCompliant) {
await fetch('https://formspree.io/f/xpzygkqr', {
method: 'POST',
headers: { 
'Content-Type': 'application/json', 
'Accept': 'application/json' 
},
body: JSON.stringify({
_subject: `ğŸš¨ ALERTE NON-CONFORMITÃ‰ - ${data.plaque} - ${defectCount} dÃ©faut(s)`,
email: 'Jacques.perrier@protonmail.com',
message: reportText,
employe: data.employe,
plaque: data.plaque,
unite: data.unite,
date: data.date,
heure: data.heure,
lieu: data.lieu,
statut: 'NON-CONFORME',
nb_defauts: defectCount
})
});
console.log('âœ… Email d\'alerte envoyÃ© Ã  Jacques.perrier@protonmail.com');
}

} catch (error) {
console.log('âš ï¸ Erreur Formspree:', error);
}

// ENVOI GOOGLE SHEETS
try {
await fetch('https://script.google.com/macros/s/AKfycbyJtgB3xd5An8RMPG-1gEwSkFe6Lfi9b5VhvxgzYGEJ7iIfGvSZH85y8Tmn3N4qLocr/exec', {
method: 'POST',
mode: 'no-cors',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({
employe: data.employe,
plaque: data.plaque,
unite: data.unite,
date: data.date,
heure: data.heure,
lieu: data.lieu,
commentaires: data.commentaires,
items: data.items
})
});
console.log('âœ… EnvoyÃ© Ã  Google Sheets');
} catch (error) {
console.log('âš ï¸ Erreur Google Sheets:', error);
}

document.getElementById('r-emp').textContent = data.employe;
document.getElementById('r-plaque').textContent = data.plaque;
document.getElementById('r-date').textContent = data.date;
document.getElementById('r-status').textContent = isCompliant ? 'âœ… CONFORME' : 'âš ï¸ NON-CONFORME';
document.getElementById('report-text').textContent = reportText;

document.getElementById('form-section').style.display = 'none';
document.getElementById('result').style.display = 'block';
window.scrollTo(0, 0);
}

function emailReport() {
const subject = encodeURIComponent(`Inspection LOISELLE - ${window.currentData.plaque}`);
const body = encodeURIComponent(window.currentReport);
window.location.href = `mailto:Mjacquesperrier@gmail.com?subject=${subject}&body=${body}`;
}

function copyReport() {
navigator.clipboard.writeText(window.currentReport).then(() => {
alert('âœ… Rapport copiÃ©!');
}).catch(() => {
const el = document.createElement('textarea');
el.value = window.currentReport;
document.body.appendChild(el);
el.select();
document.execCommand('copy');
document.body.removeChild(el);
alert('âœ… Rapport copiÃ©!');
});
}

function downloadTXT() {
const blob = new Blob([window.currentReport], { type: 'text/plain' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `Inspection_LOISELLE_${window.currentData.plaque}_${window.currentData.date}.txt`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
alert('âœ… Fichier tÃ©lÃ©chargÃ©!');
}
</script>

</body>
</html>
