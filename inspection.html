<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspection LOISELLE</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0f172a] p-2 font-sans">
    <div class="max-w-lg mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden border-t-8 border-blue-600">
        <div class="p-6 text-center border-b bg-gray-50">
            <h1 class="text-3xl font-black text-slate-800 tracking-tighter uppercase">LOISELLE</h1>
            <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Inspection Quotidienne / Daily Inspection</p>
        </div>
        
        <form id="inspectionForm" class="p-6 space-y-6">
            <div class="space-y-4 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                <div>
                    <label class="font-bold block text-sm mb-1 text-slate-700">üë§ Employ√© / Employee :</label>
                    <input type="text" name="employe" required class="w-full border-2 border-slate-200 p-3 rounded-xl shadow-sm outline-none">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="font-bold block text-sm mb-1 text-slate-700">üî¢ Plaque / Plate :</label>
                        <input type="text" name="plaque" required class="w-full border-2 border-slate-200 p-3 rounded-xl shadow-sm outline-none">
                    </div>
                    <div>
                        <label class="font-bold block text-sm mb-1 text-slate-700">üöõ Unit√© / Unit :</label>
                        <input type="text" name="unite" required class="w-full border-2 border-slate-200 p-3 rounded-xl shadow-sm outline-none">
                    </div>
                </div>
                <div>
                    <label class="font-bold block text-sm mb-1 text-slate-700">üìç Lieu / Site :</label>
                    <input type="text" name="lieu" required class="w-full border-2 border-slate-200 p-3 rounded-xl shadow-sm outline-none">
                </div>
            </div>

            <div class="space-y-3">
                <h2 class="font-black text-slate-800 uppercase text-xs tracking-widest border-b-2 pb-1">Points d'inspection / Checklist</h2>
                <div id="itemsList" class="space-y-3"></div>
            </div>

            <div class="space-y-2">
                <label class="font-bold block text-xs uppercase text-slate-500">üìù Commentaires / Comments :</label>
                <textarea name="commentaires" class="w-full border-2 border-slate-200 p-4 rounded-2xl shadow-sm outline-none" rows="3"></textarea>
            </div>

            <button type="submit" id="btnSubmit" class="w-full bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl uppercase text-xl transform active:scale-95 transition-all">Envoyer le Rapport</button>
        </form>
    </div>

    <script>
        const items = [
            {f: "Niveaux & Fuites", e: "Fluids & Leaks (Oil, Coolant, Fuel)"},
            {f: "Pneus & Boulons", e: "Tires, Wheels & Hubs"},
            {f: "Freins & Boyaux", e: "Brakes & Air Hoses"},
            {f: "Lumi√®res & Gyrophare", e: "Lights, Signals & Beacon"},
            {f: "Direction & Suspension", e: "Steering & Suspension"},
            {f: "Miroirs & Pare-brise", e: "Mirrors, Glass & Wipers"},
            {f: "√âquipement de S√©curit√©", e: "Extinguisher, Flares, First Aid"},
            {f: "Arrimage du chargement", e: "Cargo Securement & Straps"}
        ];

        const list = document.getElementById('itemsList');
        const status = {};

        items.forEach(it => {
            const div = document.createElement('div');
            div.className = "p-4 border border-slate-100 rounded-2xl bg-white shadow-sm flex flex-col gap-3";
            div.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-bold text-slate-800 text-sm uppercase">${it.f}</div>
                        <div class="text-slate-400 italic text-[10px] leading-tight">${it.e}</div>
                    </div>
                    <div class="flex gap-2">
                        <button type="button" onclick="setStat('${it.f}','OK')" id="ok-${it.f}" class="px-5 py-2 bg-white border-2 border-slate-100 rounded-xl font-bold text-xs transition-all shadow-sm">OK</button>
                        <button type="button" onclick="setStat('${it.f}','DEF')" id="def-${it.f}" class="px-5 py-2 bg-white border-2 border-slate-100 rounded-xl font-bold text-slate-400 text-xs transition-all shadow-sm uppercase">DEF</button>
                    </div>
                </div>
                <input type="text" id="note-${it.f}" placeholder="D√©tail du d√©faut / Describe issue..." class="hidden w-full border-2 border-red-100 p-3 rounded-xl text-xs bg-red-50 italic outline-none">
            `;
            list.appendChild(div);
            status[it.f] = "OK";
        });

        function setStat(it, val) {
            status[it] = val;
            const okBtn = document.getElementById(`ok-${it}`);
            const defBtn = document.getElementById(`def-${it}`);
            const noteInput = document.getElementById(`note-${it}`);
            if(val === 'OK') {
                okBtn.className = "px-5 py-2 bg-green-500 text-white rounded-xl font-bold text-xs shadow-md border-green-600";
                defBtn.className = "px-5 py-2 bg-white text-slate-300 rounded-xl font-bold text-xs border-2 border-slate-50 opacity-50";
                noteInput.classList.add('hidden');
            } else {
                defBtn.className = "px-5 py-2 bg-red-600 text-white rounded-xl font-bold text-xs shadow-md border-red-700";
                okBtn.className = "px-5 py-2 bg-white text-slate-300 rounded-xl font-bold text-xs border-2 border-slate-50 opacity-50";
                noteInput.classList.remove('hidden');
            }
        }

        document.getElementById('inspectionForm').onsubmit = async (e) => {
            e.preventDefault();
            const b = document.getElementById('btnSubmit');
            b.disabled = true; b.innerText = "ENVOI EN COURS...";
            const f = new FormData(e.target);
            const data = {
                employe: f.get('employe'), plaque: f.get('plaque'), unite: f.get('unite'),
                lieu: f.get('lieu'), commentaires: f.get('commentaires'),
                items: Object.keys(status).map(nom => ({ nom: nom, statut: status[nom], note: document.getElementById(`note-${nom}`).value }))
            };
            try {
                await fetch('https://formspree.io/f/xpzygkqr', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
                await fetch('https://script.google.com/macros/s/AKfycbz-1sHucUCXwJlTw-ga7jtmQ9j9v8Oaw0hRaREPmZBP-xyTudOthjvNbTo9KgpNFdsILA/exec', { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
                alert("‚úÖ Rapport envoy√© !");
                location.reload();
            } catch (err) { alert("Erreur."); b.disabled = false; b.innerText = "Envoyer"; }
        };
    </script>
</body>
</html>
