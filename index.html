<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOISELLE - Feuille de Temps</title>
    <style>
        :root { --primary: #12263a; --accent: #28a745; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: sans-serif; background: #0d1b2a; padding: 10px; color: #333; }
        .container { max-width: 600px; margin: auto; background: #fff; border-radius: 20px; padding: 15px; }
        .logo { text-align: center; border-bottom: 2px solid #eee; margin-bottom: 15px; padding-bottom: 10px; }
        .logo h1 { font-size: 2.2em; color: var(--primary); font-weight: 800; }
        .logo p { font-weight: bold; color: #666; text-transform: uppercase; }
        .info-card { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin: 5px 0; color: var(--primary); font-size: 0.9em; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; font-size: 16px; }
        .day-box { margin-bottom: 15px; border: 1px solid #ddd; border-radius: 12px; overflow: hidden; background: #fff; }
        .day-label { background: var(--primary); color: white; padding: 10px; text-align: center; font-weight: bold; display: flex; justify-content: space-between; }
        .time-row { padding: 10px; border-bottom: 1px solid #eee; background: #fafafa; }
        .row-inputs { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; align-items: end; }
        .total-banner { background: var(--accent); color: white; padding: 15px; border-radius: 10px; text-align: center; font-size: 20px; font-weight: bold; margin: 20px 0; }
        .sig-container { border: 2px dashed #ccc; border-radius: 10px; margin-top: 10px; background: #fff; }
        #sig-canvas { width: 100%; height: 150px; touch-action: none; cursor: crosshair; }
        .btn-submit { background: #ffc107; width: 100%; padding: 20px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; color: #12263a; }
        .btn-clear { background: #eee; border: none; padding: 8px 15px; border-radius: 5px; font-size: 0.8em; margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="container">
    <div class="logo"><h1>LOISELLE</h1><p>FEUILLE DE TEMPS</p></div>
    <form id="loiselleForm" action="https://formspree.io/f/xdadypze" method="POST">
        
        <div class="total-banner">TOTAL : <span id="totalHrs">0.00</span>h</div>
        <input type="hidden" name="_TOTAL_DE_LA_SEMAINE" id="totalInput">

        <div class="info-card">
            <label>üë§ Employ√© :</label>
            <input type="text" name="1_NOM_EMPLOYE" placeholder="Entrez votre nom" required>
            <label>üìÖ Semaine du (Dimanche) :</label>
            <input type="date" name="2_DATE_DE_DEBUT" required>
        </div>

        <div id="formContent"></div>
        
        <div class="info-card">
            <label>‚úçÔ∏è Signature :</label>
            <button type="button" class="btn-clear" onclick="clearSig()">Effacer / Clear</button>
            <div class="sig-container">
                <canvas id="sig-canvas"></canvas>
            </div>
        </div>
        <input type="hidden" name="ZZ_SIGNATURE_DATA" id="sig-data">

        <button type="submit" id="submitBtn" class="btn-submit" style="margin-top:20px">üöÄ ENVOYER / SUBMIT</button>
    </form>
</div>

<script>
    const days = [
        {fr:'Dimanche', en:'Sunday'}, {fr:'Lundi', en:'Monday'}, {fr:'Mardi', en:'Tuesday'}, 
        {fr:'Mercredi', en:'Wednesday'}, {fr:'Jeudi', en:'Thursday'}, {fr:'Vendredi', en:'Friday'}, {fr:'Samedi', en:'Saturday'}
    ];

    let html = '';
    days.forEach((day, i) => {
        html += `<div class="day-box"><div class="day-label"><span>${day.fr}</span><span>${day.en}</span></div>`;
        for(let r=1; r<=2; r++) {
            html += `<div class="time-row">
                <div class="row-inputs">
                    <div>
                        <label style="font-size:0.7em">${r===1?'Projet':''}</label>
                        <select name="${day.fr}_Projet_${r}">
                            <option value="">Code?</option>
                            <option value="CCR">CCR</option>
                            <option value="25903-00">25903-00</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:0.7em">D√©but (S${r})</label>
                        <select name="${day.fr}_Debut_${r}" id="s${i}_${r}" onchange="calc()">${genTime()}</select>
                    </div>
                    <div>
                        <label style="font-size:0.7em">Fin (E${r})</label>
                        <select name="${day.fr}_Fin_${r}" id="e${i}_${r}" onchange="calc()">${genTime()}</select>
                    </div>
                </div>
            </div>`;
        }
        html += `</div>`;
    });
    document.getElementById('formContent').innerHTML = html;

    function genTime() { 
        let h='<option value="">--:--</option>'; 
        for(let i=0;i<24;i++) for(let m=0;m<60;m+=30) { 
            let t=(i<10?'0'+i:i)+':'+(m<10?'0'+m:m); 
            h+=`<option value="${t}">${t}</option>`; 
        } return h; 
    }

    function calc() {
        let total = 0;
        for(let i=0; i<7; i++) {
            for(let r=1; r<=2; r++) {
                let s = document.getElementById(`s${i}_${r}`).value, e = document.getElementById(`e${i}_${r}`).value;
                if(s && e) {
                    let d = (parseInt(e.split(':')[0])*60+parseInt(e.split(':')[1])) - (parseInt(s.split(':')[0])*60+parseInt(s.split(':')[1]));
                    if(d<0) d+=1440; total += d/60;
                }
            }
        }
        const finalVal = total.toFixed(2);
        document.getElementById('totalHrs').textContent = finalVal;
        document.getElementById('totalInput').value = finalVal + " h";
    }

    const canvas = document.getElementById('sig-canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    function resizeCanvas() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        ctx.lineWidth = 2; ctx.lineCap = 'round';
    }
    window.onload = resizeCanvas;
    window.onresize = resizeCanvas;

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
        const clientY = (e.touches ? e.touches[0].clientY : e.clientY);
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    canvas.addEventListener('mousedown', (e) => { drawing = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); });
    canvas.addEventListener('mousemove', (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); });
    window.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('touchstart', (e) => { drawing = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); e.preventDefault(); }, {passive: false});
