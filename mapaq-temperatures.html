<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAPAQ - TempÃ©ratures</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#0f2942,#1e3a5f);padding:10px;color:#333;min-height:100vh;}
.container{max-width:600px;margin:auto;background:white;border-radius:15px;padding:20px;box-shadow:0 5px 30px rgba(0,0,0,.3);}
.header{background:#12263a;color:white;padding:20px;margin:-20px -20px 15px;border-radius:15px 15px 0 0;text-align:center;}
.header h1{font-size:1.5em;margin-bottom:3px;}
.header p{color:#ffc107;font-size:0.85em;}
.back{color:#8ba4bc;text-decoration:none;font-size:0.85em;display:inline-block;margin-bottom:8px;}
.norms{background:#e8f4fd;border:1px solid #bee5eb;border-radius:8px;padding:10px;margin-bottom:12px;font-size:0.8em;color:#0c5460;line-height:1.5;}
.section{background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:12px;}
.section h3{color:#12263a;margin-bottom:10px;font-size:1em;}
label{display:block;font-weight:bold;margin:8px 0 4px;color:#12263a;font-size:0.85em;}
input,textarea,select{width:100%;padding:11px;border:2px solid #ddd;border-radius:8px;font-size:16px;margin-bottom:8px;font-family:inherit;}
input:focus,select:focus,textarea:focus{outline:none;border-color:#28a745;}
.item{background:white;padding:12px 15px;border-radius:10px;margin-bottom:8px;border:2px solid #e9ecef;}
.item-header{display:flex;justify-content:space-between;align-items:center;}
.item-name{font-weight:bold;color:#333;font-size:0.9em;}
.item-name small{display:block;color:#888;font-size:0.8em;font-weight:normal;}
.temp-input{display:flex;gap:8px;align-items:center;margin-top:8px;}
.temp-input input{width:100px;text-align:center;font-weight:bold;font-size:1.1em;}
.temp-input .unit{font-weight:bold;color:#12263a;}
.badge{padding:4px 10px;border-radius:15px;font-size:0.75em;font-weight:bold;display:inline-block;}
.badge-ok{background:#d4edda;color:#155724;}
.badge-bad{background:#f8d7da;color:#721c24;}
.btn{width:100%;padding:14px;border:none;border-radius:10px;font-size:1em;font-weight:bold;cursor:pointer;margin-top:8px;}
.btn-add{background:#28a745;color:white;}
.btn-add:active{transform:scale(0.98);}
.btn-submit{background:#ffc107;color:#12263a;text-transform:uppercase;letter-spacing:1px;margin-top:15px;}
.btn-submit:active{transform:scale(0.98);}
.sig-box{border:3px dashed #ccc;border-radius:10px;height:120px;background:white;position:relative;cursor:crosshair;touch-action:none;}
.sig-box canvas{width:100%;height:100%;}
.sig-clear{position:absolute;top:5px;right:5px;background:#d9534f;color:white;border:none;padding:4px 10px;border-radius:5px;font-size:0.75em;cursor:pointer;}
.emp-bar{background:#12263a;color:white;padding:8px 15px;margin:-20px -20px 15px;border-radius:0;display:flex;justify-content:space-between;font-size:0.85em;}
.emp-bar .name{color:#ffc107;font-weight:bold;}
#login{padding:0;}
#result{display:none;}
.success{background:#d4edda;border:2px solid #28a745;padding:20px;border-radius:10px;color:#155724;}
.success h2{margin-bottom:10px;color:#28a745;}
.report{background:white;padding:12px;border-radius:8px;margin:12px 0;border-left:4px solid #28a745;max-height:300px;overflow-y:auto;}
.report pre{white-space:pre-wrap;font-size:0.8em;line-height:1.5;font-family:monospace;}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}
.action-btns button{padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;color:white;font-size:0.85em;}
.count{background:#12263a;color:white;padding:3px 10px;border-radius:20px;font-size:0.75em;margin-left:5px;}
</style>
</head>
<body>
<div class="container">
<div class="header">
<a class="back" href="mapaq.html">â† Retour aux registres</a>
<h1>ğŸŒ¡ï¸ TEMPÃ‰RATURES</h1>
<p>REGISTRE QUOTIDIEN â€” MAPAQ</p>
</div>

<!-- LOGIN -->

<div id="login">
<div class="section">
<h3>ğŸ‘¤ Identification</h3>
<label>Votre nom</label>
<input type="text" id="user-name" placeholder="PrÃ©nom et nom">
<label>Poste</label>
<select id="user-poste">
<option>Cuisinier(Ã¨re)</option><option>Chef / Sous-chef</option><option>Gestionnaire</option><option>Plongeur(euse)</option><option>Serveur(euse)</option><option>Commis</option><option>PropriÃ©taire</option>
</select>
<button class="btn btn-submit" onclick="doLogin()">COMMENCER â†’</button>
</div>
</div>

<!-- MAIN -->

<div id="main" style="display:none;">
<div class="emp-bar">
<span>ğŸ‘¤ <span class="name" id="d-name"></span></span>
<span id="d-date"></span>
</div>

<div class="norms">
<strong>Normes MAPAQ :</strong> RÃ©frigÃ©ration 0-4Â°C Â· CongÃ©lation â‰¤ âˆ’18Â°C Â· Maintien chaud â‰¥ 60Â°C Â· Lave-vaisselle â‰¥ 82Â°C
</div>

<div class="section">
<h3>ğŸŒ¡ï¸ Nouvelle mesure</h3>
<label>Ã‰quipement</label>
<select id="equip">
<option value="RÃ©frigÃ©rateur 1|0|4">RÃ©frigÃ©rateur 1 (0-4Â°C)</option>
<option value="RÃ©frigÃ©rateur 2|0|4">RÃ©frigÃ©rateur 2 (0-4Â°C)</option>
<option value="CongÃ©lateur|-25|-18">CongÃ©lateur (â‰¤ âˆ’18Â°C)</option>
<option value="Table froide / Bar Ã  salade|0|4">Table froide (0-4Â°C)</option>
<option value="Maintien chaud|60|100">Maintien chaud (â‰¥ 60Â°C)</option>
<option value="Lave-vaisselle (rinÃ§age)|82|100">Lave-vaisselle (â‰¥ 82Â°C)</option>
</select>
<div class="temp-input">
<label style="margin:0;white-space:nowrap;">Temp:</label>
<input type="number" step="0.1" id="temp-val" placeholder="0.0" oninput="checkNorm()">
<span class="unit">Â°C</span>
<span class="badge" id="norm-badge" style="display:none;"></span>
</div>
<label>Action corrective (si non conforme)</label>
<textarea id="corrective" rows="2" placeholder="DÃ©crivez l'action..."></textarea>
<button class="btn btn-add" onclick="addEntry()">âœ“ AJOUTER LA MESURE</button>
</div>

<div id="entries"></div>
<div id="entry-count" style="text-align:center;color:#888;font-size:0.85em;margin:10px 0;"></div>

<div class="section">
<h3>âœï¸ Signature</h3>
<div class="sig-box"><canvas id="canvas"></canvas><button class="sig-clear" onclick="clearSig()">Effacer</button></div>
</div>
<button class="btn btn-submit" onclick="submitForm()">ğŸš€ SOUMETTRE LE RELEVÃ‰</button>
</div>

<!-- RESULT -->

<div id="result">
<div class="success">
<h2>âœ… RELEVÃ‰ ENREGISTRÃ‰</h2>
<p><strong>Responsable:</strong> <span id="r-emp"></span></p>
<p><strong>Date:</strong> <span id="r-date"></span></p>
<p><strong>Statut:</strong> <span id="r-status"></span></p>
<div class="report"><pre id="report-text"></pre></div>
<div class="action-btns">
<button onclick="emailReport()" style="background:#007bff;">ğŸ“§ EMAIL</button>
<button onclick="copyReport()" style="background:#6c757d;">ğŸ“‹ COPIER</button>
<button onclick="downloadTXT()" style="background:#28a745;">ğŸ’¾ TXT</button>
<button onclick="location.reload()" style="background:#17a2b8;">ğŸ”„ NOUVEAU</button>
</div>
<div style="margin-top:12px;text-align:center;">
<a href="mapaq.html" style="color:#155724;font-weight:bold;">â† Retour aux registres</a>
</div>
</div>
</div>
</div>

<script>
let user={}, entries=[], hasSig=false;

function doLogin(){
  const n=document.getElementById('user-name').value.trim();
  if(!n){alert('âŒ Entrez votre nom');return;}
  user={nom:n,poste:document.getElementById('user-poste').value};
  document.getElementById('d-name').textContent=n;
  document.getElementById('d-date').textContent=new Date().toLocaleDateString('fr-CA');
  document.getElementById('login').style.display='none';
  document.getElementById('main').style.display='block';
  initCanvas();
}

function checkNorm(){
  const v=parseFloat(document.getElementById('temp-val').value);
  const p=document.getElementById('equip').value.split('|');
  const b=document.getElementById('norm-badge');
  if(isNaN(v)){b.style.display='none';return;}
  b.style.display='inline-block';
  if(v>=parseFloat(p[1])&&v<=parseFloat(p[2])){b.textContent='âœ“ CONFORME';b.className='badge badge-ok';}
  else{b.textContent='âœ— HORS NORME';b.className='badge badge-bad';}
}

function addEntry(){
  const v=parseFloat(document.getElementById('temp-val').value);
  if(isNaN(v)){alert('âŒ Entrez une tempÃ©rature');return;}
  const p=document.getElementById('equip').value.split('|');
  const ok=v>=parseFloat(p[1])&&v<=parseFloat(p[2]);
  entries.push({
    date:new Date().toLocaleDateString('fr-CA'),
    heure:new Date().toLocaleTimeString('fr-CA',{hour:'2-digit',minute:'2-digit'}),
    equipement:p[0],temperature:v,conforme:ok,
    corrective:document.getElementById('corrective').value,
    responsable:user.nom
  });
  document.getElementById('temp-val').value='';
  document.getElementById('corrective').value='';
  document.getElementById('norm-badge').style.display='none';
  render();
}

function render(){
  document.getElementById('entries').innerHTML=entries.map(e=>`
    <div class="item" style="border-left:4px solid ${e.conforme?'#28a745':'#d9534f'};">
      <div class="item-header">
        <div class="item-name">${e.equipement}<small>${e.date} ${e.heure}</small></div>
        <div><span style="font-weight:bold;font-size:1.1em;color:${e.conforme?'#28a745':'#d9534f'}">${e.temperature}Â°C</span>
        <span class="badge ${e.conforme?'badge-ok':'badge-bad'}" style="margin-left:5px;">${e.conforme?'âœ“':'âœ—'}</span></div>
      </div>
      ${e.corrective?`<div style="color:#d9534f;font-size:0.85em;margin-top:5px;">ğŸ“ ${e.corrective}</div>`:''}
    </div>`).join('');
  document.getElementById('entry-count').textContent=`${entries.length} mesure(s) enregistrÃ©e(s)`;
}

// Signature
let canvas,ctx,drawing=false;
function initCanvas(){
  canvas=document.getElementById('canvas');ctx=canvas.getContext('2d');
  setTimeout(()=>{canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;ctx.lineWidth=2;ctx.lineCap='round';ctx.strokeStyle='#000';},100);
  canvas.addEventListener('mousedown',e=>{drawing=true;hasSig=true;const r=canvas.getBoundingClientRect();ctx.beginPath();ctx.moveTo(e.clientX-r.left,e.clientY-r.top);});
  canvas.addEventListener('mousemove',e=>{if(!drawing)return;const r=canvas.getBoundingClientRect();ctx.lineTo(e.clientX-r.left,e.clientY-r.top);ctx.stroke();});
  canvas.addEventListener('mouseup',()=>drawing=false);
  canvas.addEventListener('touchstart',e=>{e.preventDefault();drawing=true;hasSig=true;const r=canvas.getBoundingClientRect();ctx.beginPath();ctx.moveTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);});
  canvas.addEventListener('touchmove',e=>{e.preventDefault();if(!drawing)return;const r=canvas.getBoundingClientRect();ctx.lineTo(e.touches[0].clientX-r.left,e.touches[0].clientY-r.top);ctx.stroke();});
  canvas.addEventListener('touchend',()=>drawing=false);
}
function clearSig(){ctx.clearRect(0,0,canvas.width,canvas.height);hasSig=false;}

function submitForm(){
  if(entries.length===0){alert('âŒ Ajoutez au moins une mesure');return;}
  if(!hasSig){alert('âŒ Veuillez signer');return;}
  const nc=entries.filter(e=>!e.conforme).length;
  const ok=nc===0;
  const today=new Date().toLocaleDateString('fr-CA');
  let rpt=`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  RELEVÃ‰ DES TEMPÃ‰RATURES â€” MAPAQ\n  ${today}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
  rpt+=`ğŸ‘¤ Responsable: ${user.nom} (${user.poste})\nğŸ“… Date: ${today}\nğŸ“Š STATUT: ${ok?'âœ… CONFORME':'âš ï¸ NON-CONFORME ('+nc+' hors norme)'}\n\n`;
  entries.forEach((e,i)=>{rpt+=`${i+1}. ${e.equipement}: ${e.temperature}Â°C ${e.conforme?'âœ“':'âœ— NON CONFORME'}\n`;if(e.corrective)rpt+=`   ğŸ“ ${e.corrective}\n`;});
  rpt+=`\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nLoi sur les produits alimentaires (RLRQ, c. P-29)\nGÃ©nÃ©rÃ©: ${new Date().toLocaleString('fr-CA')}\n`;
  window.currentReport=rpt;window.currentData={employe:user.nom,date:today};
  document.getElementById('r-emp').textContent=user.nom;
  document.getElementById('r-date').textContent=today;
  document.getElementById('r-status').textContent=ok?'âœ… CONFORME':'âš ï¸ NON-CONFORME';
  document.getElementById('report-text').textContent=rpt;
  document.getElementById('main').style.display='none';
  document.getElementById('result').style.display='block';
  window.scrollTo(0,0);
}

function emailReport(){const s=encodeURIComponent(`TempÃ©ratures MAPAQ - ${window.currentData.date}`);const b=encodeURIComponent(window.currentReport);window.location.href=`mailto:Mjacquesperrier@gmail.com?subject=${s}&body=${b}`;}
function copyReport(){navigator.clipboard.writeText(window.currentReport).then(()=>alert('âœ… CopiÃ©!')).catch(()=>{const el=document.createElement('textarea');el.value=window.currentReport;document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);alert('âœ… CopiÃ©!');});}
function downloadTXT(){const b=new Blob([window.currentReport],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`MAPAQ_Temperatures_${window.currentData.date}.txt`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);}
</script>

</body>
</html>
